---
title: "Analyzing Business Relations & Documents"
subtitle: "Spatial Statistics"
author: "Prof. Dr. Jörg Schoder"
institute: "FFHS" 
date: "`r Sys.Date()`"
bibliography: ../../lit/my_bib.bib
reference-section-title: Quellenverzeichnis
output:
  xaringan::moon_reader:
    self_contained: true
    css: 
         - default
         - ../../css/ffhs-theme_js.css
         - xaringan-themer.css
    includes:
      after_body: ../../css/insert-logo.html
    lib_dir: ../../libs
    nature:
      slideNumberFormat: "%current%/%total%"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
    seal: false
    

    
---
class: title-slide

```{r xaringan-themer, include=FALSE}
library(xaringanthemer)
style_xaringan(text_color = "#d50006",inverse_text_color = "#FFFFFF",inverse_background_color = "#d50006", title_slide_background_color = "#d50006",header_background_color = "#d50006",header_color = "#FFFFFF",header_h1_font_size = "32px",
  header_h2_font_size = "26px",link_color="#502479",
  header_h3_font_size = "20px",text_slide_number_color = "#d50006",text_slide_number_font_size = "0.5em")
```

```{r xaringanExtra, echo=FALSE}
xaringanExtra::use_progress_bar(color = "#d50006", location = "bottom")
xaringanExtra::use_xaringan_extra(c("tile_view","scribble","panelset","tachyons"))
xaringanExtra::style_panelset_tabs(font_family = "inherit")
#xaringanExtra::use_search(show_icon = TRUE)
#weitere: "share_again","animate_css", "webcam","freezeframe","clipboard","fit_screen","extra-styles" 
xaringanExtra::use_editable(expires = 1)
xaringanExtra::use_freezeframe(trigger = "hover")
``` 

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(latex2exp)
library(fontawesome)
library(emo)
source(xfun::from_root("lit","helper.R"))
library(RefManageR)
BibOptions(check.entries = FALSE, 
           bib.style = "authoryear", 
           style = "markdown",
           dashed = TRUE)
file.name <- system.file("Bib", 
                         "my_bib.bib", 
                         package = "RefManageR")
bib <- ReadBib(xfun::from_root("lit","my_bib.bib"))
```

# ER018 - Analyzing Business Relations & Documents

## PVA3

### Teil 2: Analyse Räumlicher Daten in R

 

<br>
<br>
<br>
<br>
<br>
<br>
<br>
### FS 2024
<br>
### Prof. Dr. Jörg Schoder
.mycontacts[
`r fa('github')` @FFHS-EconomicResearch
`r fa('linkedin')` @jfschoder
]


---
layout: true

<div class="my-footer"></div>       

<div style="position: absolute;left:400px;bottom:10px;font-size:9px">`r fa('creative-commons')``r rmarkdown::metadata$author`</div>


---
name: agenda
class: left

.blockquote[Agenda]

## Analyse Räumlicher Daten in R


* Karten erstellen

* Räumliche Regression

* Räumliche Netzwerke
 



???



[Beispiel](https://crd230.github.io/lab9.html)




[Scott](https://www.esri.com/news/arcwatch/0410/lauren-scott.html)





---
class: inverse, center, middle

## Kartenerstellung in R

.blockquote[Einfache Kartierung mit ggplot]

.blockquote[simple features und das sf-Paket]


.blockquote[Interaktive Karten mit Leaflet]

.blockquote[Schweizer Geodaten]




---
class: left

.blockquote[Einfache Kartierung mit ggplot]

## Simple Karte


.panelset[
.panel[.panel-name[Top5 CH-Städte]
```{r}
#| message: false
#| warning: false
library(tidyverse)
my_in_file <- "CitiesCH_(simplemaps.com).csv"
tbl_citiesCH <- read_csv(xfun::from_root("data","raw","PVA3",my_in_file))
tbl_citiesCH5 <- tbl_citiesCH %>% 
                          arrange(desc(population)) %>% slice_head(n=5)
tbl_citiesCH5
```
]
.panel[.panel-name[Einfache Abbildung]
```{r}
#| out-width: "50%"
#| fig-align: "center"
tbl_citiesCH5 %>% 
    ggplot(aes(x = lng, y = lat)) + geom_point()
```
]
.panel[.panel-name[Labels ergänzen]
```{r}
#| out-width: "50%"
#| fig-align: "center"
tbl_citiesCH5 %>% 
    ggplot(aes(x = lng, y = lat)) + geom_point() + 
      geom_text(aes(label=city),hjust=1, vjust=-0.5) + 
      scale_x_continuous(limits = c(5.5,9))
```
]
.panel[.panel-name[Gewichtung]
```{r}
#| out-width: "50%"
#| fig-align: "center"
tbl_citiesCH5 %>% 
    ggplot(aes(x = lng, y = lat)) + geom_point(aes(size=population)) + 
      geom_text(aes(label=city),hjust=1, vjust=-0.5) + 
      scale_x_continuous(limits = c(5.5,9))
```
]
]


---
class: left

.blockquote[Einfache Kartierung mit ggplot]

## Arten räumlicher Daten

```{r}
#| echo: false
knitr::include_url("https://www.paulamoraga.com/book-spatial/types-of-spatial-data.html", height = "480px")
```


???

* Flächenbezogene Daten (bspw. Kanton und Bevölkerungsanzahl)

* Geodaten (mit Koordinaten) - bekannte Orte

* Punktmuster (mit Koordinaten) - unbekannte/zufällige Orte, bspw´. Waldbrand

* Raum-Zeit-Daten. Entwicklung über die Zeit, bspw. Luftverschmutzung, Kaufkraft...

* Mobilitätsdaten





---
class: left

.blockquote[simple features und das sf-Paket]

## Dateiformate für räumliche Daten

<br>

.pull-left[
```{r}
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(xfun::from_root("img","PVA3","Vektordaten_Dateiformate_(SurveyGyaan_2022)_medium.PNG"))
```
]
--
.pull-right[
```{r}
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(xfun::from_root("img","PVA3","Rasterdaten_Dateiformate_(SurveyGyaan_2022)_medium.PNG"))
```
]


.quelle[Quelle: `r Citet(bib,"surveygyaan_vector_2022")`, `r Citet(bib,"surveygyaan_raster_2022")`.]




---
class: left

.blockquote[simple features und das sf-Paket]

## Warum das sf-Paket?

* Schnelles Lesen und Schreiben von Daten

--

* Verbesserte Leistung beim Plotten

--

* Verwendung von `sf`-Objekten (in der Regel) wie `data.frame`- oder `tibble-Objekte`

--

* konsistente und intuitive Verben als Funktionsnamen (beginnen mit `st_`)

--

* Kompatibilität mit tidyverse-Synatax und Verwendung mit Pipes



---
class: left

.blockquote[simple features und das sf-Paket]

## Simple Features und sf-Paket

```{r}
#| echo: false
#| out-width: "80%"
#| fig-align: "center"
knitr::include_graphics(xfun::from_root("img","PVA3","02-sfdiagram.png"))
```

Elemente von sf-Objekten:

* sfg

* sfc






---
class: left

.blockquote[Kartenerstellung]

## Kartenerstellung mit `geom_sf()` in ggplot2

```{r}
#| echo: false
knitr::include_url("https://www.paulamoraga.com/book-spatial/making-maps-with-r.html",height = "480px")
```



---
class: left

## Kartogramme als alternative Darstellungsform

```{r}
#| echo: false
#| out-width: "100%"
#| fig-align: "center"
knitr::include_graphics(xfun::from_root("img","PVA3","Grid_People_Population_2020_(worldmapper.org).png"))
```

.quellePan[Bildquelle: [worldmapper.org](https://worldmapper.org/maps/grid-population-2020/).]







---
class: left

.blockquote[Schweizer Geodaten]

## Landesgrenze Schweiz

```{r}
library(ggswissmaps)
ggswissmaps::maps2$g1l15
```


---
class: left

.blockquote[Schweizer Geodaten]

## Aufgabe

1. Verwende das **ggswissmaps**-Paket und suche aus dem Objekt `maps2` den Plot der Schweiz, der neben der Landesgrenze auch die Kantone abbildet.

2. Verwende das **ggswissmaps**-Paket und suche aus dem Objekt `maps2` den Plot der die Gewässer abbildet.

--



```{r}
#| eval: false
ggswissmaps::maps2$g1k15
```
```{r}
#| eval: false
ggswissmaps::maps2$g1s15
```



---
class: left

.blockquote[Schweizer Geodaten]

## SBB-Liniennetz

```{r}
#| echo: false
#| cache: true
library(geojsonsf)
#sf <- geojson_sf("https://data.sbb.ch/api/explore/v2.1/catalog/datasets/linie-mit-polygon/exports/geojson")
sf <- geojson_sf(xfun::from_root("data","raw","PVA3","linie-mit-polygon.geojson"))
sf %>% ggplot2::ggplot() + geom_sf() + theme_void()
```


???

[swissgd](https://github.com/zumbov2/swissgd)

[bfsMaps](https://cran.r-project.org/web/packages/bfsMaps/bfsMaps.pdf)

[RSwissMaps](https://github.com/zumbov2/RSwissMaps) aktuell noch nicht verfügbar für R4.4.0



---
class: left

```{r}
library(geojsonsf)
#sf <- geojson_sf("https://data.sbb.ch/api/explore/v2.1/catalog/datasets/linie-mit-polygon/exports/geojson")
sf_london <- geojson_sf(xfun::from_root("data","raw","PVA3","london_421.geojson"))
sf_zh <- geojson_sf(xfun::from_root("data","raw","PVA3","zurich-small_.geojson"))
p_zh <- sf_zh %>% ggplot2::ggplot() + geom_sf() + theme_void()
p_ld <- sf_london %>% ggplot2::ggplot() + geom_sf() + theme_void()
library(patchwork)
p_zh+p_ld
```

???

Quelle: [](https://cartographyvectors.com/map/421-london#google_vignette)




---
class: left


## Aufgabe

* Suche eine geojson-Datei mit Geoinformationen zu Zürich und speichere die .geojson-Datei im Ordner "data/raw"

* Lade die Datei als sf-Objekt

* Stelle die Umrisse der Stadt Zürich mit Hilfe des `geom_sf()` aus dem **ggplot2**-Paket


???


```{r}
library(geojsonsf)
#sf <- geojson_sf("https://data.sbb.ch/api/explore/v2.1/catalog/datasets/linie-mit-polygon/exports/geojson")
sf_london <- geojson_sf(xfun::from_root("data","raw","PVA3","london_421.geojson"))
sf_zh <- geojson_sf(xfun::from_root("data","raw","PVA3","zurich-small_.geojson"))
p_zh <- sf_zh %>% ggplot2::ggplot() + geom_sf() + theme_void()
p_ld <- sf_london %>% ggplot2::ggplot() + geom_sf() + theme_void()
library(patchwork)
p_zh+p_ld
```


Quelle: [](https://cartographyvectors.com/map/421-london#google_vignette)



```{r}
#| include: false
#| label: get-data
#http://insideairbnb.com/get-the-data/
library(data.table)
ZH_listings <- fread('http://data.insideairbnb.com/switzerland/z%C3%BCrich/zurich/2023-09-24/data/listings.csv.gz')

ZH_locations <- geojsonsf::geojson_sf("http://data.insideairbnb.com/switzerland/z%C3%BCrich/zurich/2023-09-24/visualisations/neighbourhoods.geojson")

```

---
class: left

## Airbnb Zürich

.panelset[
.panel[.panel-name[Bezirke]
```{r}
#| label: create-map
library(leaflet)
ZH_locations$geometry %>% leaflet() %>% 
  addTiles() %>%  addPolygons(label = paste0("Kreis ", 
                            tidyr::extract_numeric(ZH_locations$neighbourhood_group),
                            ", ", ZH_locations$neighbourhood))
```

]
.panel[.panel-name[Angebote]
```{r}
#| label: plot-offers
ZH_listings %>% 
  select(latitude,longitude) %>% 
  leaflet() %>% 
  addTiles() %>% 
  addMarkers()
```

]
]





???



```{r}
#| message: false
#| warning: false
library(tidyverse)
tbl_starbucks <- read_csv(xfun::from_root("data","raw","PVA3","starbucks_(kaggle).zip"))
starbucks_zh <- tbl_starbucks %>% 
                        filter(City=="Zurich"&Country=="CH")
```









---
class: left

## Permutation

```{r}
#| echo: false
#| out-width: "90%"
#| fig-align: "center"
knitr::include_graphics(xfun::from_root("img","PVA3","worldmap_permutation_(Jacobs_2010)_ritzholtz.com.jpg"))
```

.quelle[Bildquelle: [ritholtz.com](https://ritholtz.com/2010/11/world-map-rearranged-by-population/).]









---
class: inverse,center,middle

# Vielen Dank für die Aufmerksamkeit!

---

background-image: url("http://bit.ly/cs631-donkey")
background-size: 80%





---
class: left

## Quellenverzeichnis

.ref-slide[
```{r, results='asis', echo=FALSE, warning=FALSE}
PrintBibliography(bib)
```
]
